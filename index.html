
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2ND SEC TERM 1 ‚Äî Unit 1 Platform (v4)</title>
<style>
  :root{--prim:#00c2a8; --prim2:#7fffd4; --accent:#ff7ab8; --violet:#9b8cfc; --bg:#f6fbff; --card:#fff; --text:#0f2e3a; --ok:#2ecc71; --bad:#ff5a5a}
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--text)}
  header{background:linear-gradient(120deg,var(--prim),var(--prim2)); color:#fff; padding:16px 12px; position:sticky; top:0; z-index:20; box-shadow:0 10px 24px rgba(0,0,0,.12)}
  .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
  .title{font-weight:900; font-size:18px}
  .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .tab{border:none; background:#fff; color:var(--text); padding:10px 14px; border-radius:12px; font-weight:700; box-shadow:0 8px 20px rgba(0,0,0,.06); cursor:pointer}
  .tab.active{background:var(--prim); color:#fff}
  main{padding:12px}
  .panel{display:none}
  .panel.active{display:block}
  .subtabs{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px}
  .sub{border:none; background:#fff; color:var(--text); padding:8px 12px; border-radius:999px; font-weight:700; box-shadow:0 6px 16px rgba(0,0,0,.06); cursor:pointer}
  .sub.active{background:var(--violet); color:#fff}
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px}
  .card{background:var(--card); border-radius:12px; padding:12px; box-shadow:0 12px 28px rgba(0,0,0,.06)}
  .word{font-size:20px; font-weight:900}
  .arabic{color:#547; font-size:14px}
  .example{margin-top:6px; font-size:14px}
  .btn{border:none; background:var(--prim); color:#fff; padding:8px 10px; border-radius:10px; font-weight:800; cursor:pointer}
  .btn.out{background:#fff; color:var(--prim); border:2px solid var(--prim)}
  .dict{background:#fff; border-radius:12px; padding:12px; margin-top:12px}
  .dict .rowi{display:flex; gap:8px; align-items:center; margin:6px 0}
  .dict input{flex:1; padding:8px 10px; border-radius:8px; border:2px solid #e8f2f5}
  .match{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .pile{background:#fff; border-radius:12px; padding:12px; min-height:220px}
  .draggable{background:#f8fbff; border:2px dashed #d7eaf0; padding:8px 10px; border-radius:10px; margin:6px 0; cursor:grab}
  .slot{background:#f8fbff; border:2px dashed #d7eaf0; padding:10px; border-radius:10px; margin:6px 0; min-height:42px}
  .slot.filled{border-color:var(--ok); background:#eafff3}
  .quiz{background:#fff; border-radius:12px; padding:12px}
  .choices{display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:8px; margin-top:6px}
  .choice{background:#f9fcff; border:2px solid transparent; padding:12px; border-radius:12px; cursor:pointer; font-weight:800}
  .choice.ok{border-color:var(--ok); background:#ecfff3}
  .choice.bad{border-color:var(--bad); background:#ffefef}
  .exam{background:#fff; border-radius:12px; padding:12px}
  .item{padding:10px; border:1px dashed #d9e6ea; border-radius:10px; margin:8px 0}
  .pill{padding:6px 10px; border-radius:999px; background:#eef8ff; display:inline-block; margin:6px 0}
  .tools{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .progress{height:10px; width:100%; background:#eef2f6; border-radius:999px; overflow:hidden}
  .progress > div{height:100%; background:linear-gradient(90deg,#00c2a8,#7fffd4); width:0%}
  .streak{font-weight:800}
  .timer{font-weight:900; color:#b1003a}
  .review{position:fixed; inset:0; background:#0008; display:none; align-items:center; justify-content:center}
  .review .inner{background:#fff; color:#0f2e3a; width:min(900px,92vw); max-height:80vh; overflow:auto; border-radius:16px; padding:16px; box-shadow:0 20px 40px rgba(0,0,0,.25)}
  .review h3{margin:0 0 8px}
  .review .close{float:right}
  .review .qa{padding:8px; border:1px dashed #d9e6ea; border-radius:10px; margin:6px 0}
  .okpill{display:inline-block; background:#ecfff3; color:#1d7f3b; padding:4px 10px; border-radius:999px; font-weight:700}
  .badpill{display:inline-block; background:#ffecec; color:#9a1f1f; padding:4px 10px; border-radius:999px; font-weight:700}
  @media print{ header, .tabs, .tools, .toast, .subtabs, .match, .quiz, .dict, .exam .item > div .choice {display:none !important} body{background:#fff} .certificate{display:block!important} }
  .certificate{display:none; background:#fff; color:#000; padding:40px; border:6px double #333; border-radius:16px; text-align:center}
</style>
</head>
<body>
<header>
  <div class="row">
    <div class="title">2ND SEC TERM 1 ‚Äî Unit 1: Egypt‚ÄìAfrica Cooperation (v4)</div>
    <div class="tools">
      <input id="studentName" placeholder="Student name" class="btn out" style="background:#fff; color:#0f2e3a;" />
      <label class="btn out"><input type="checkbox" id="timerToggle" style="accent-color:#00c2a8; margin-right:6px"> Timer 12 min</label>
      <button class="btn" id="shareBtn">üîó Share</button>
    </div>
  </div>
  <div class="tabs" id="tabs"></div>
</header>
<main id="content"></main>
<div class="toast" id="toast"></div>
<div class="review" id="review"><div class="inner"><button class="btn out close" id="closeReview">Close ‚úñ</button><h3>Review ‚Äî Correct answers & your selections</h3><div id="reviewBody"></div></div></div>
<div id="printCert" class="certificate">
  <h1>Certificate of Achievement</h1>
  <p>This certifies that</p>
  <h2 id="certName">[Student Name]</h2>
  <p>has successfully passed</p>
  <h3>Unit 1 ‚Äî Egypt‚ÄìAfrica Cooperation</h3>
  <p>Score: <span id="certScore"></span> ‚Äî Badge: <span id="certBadge"></span></p>
  <p style="margin-top:20px">Designed for <strong>Asmaa Mahmoud El‚ÄëHagarsi</strong></p>
  <p style="font-size:12px;opacity:.7">Print this page to download your certificate.</p>
</div>
<script>
const lessons = [{"title": "Lesson 1", "vocab": [{"w": "gateway", "ar": "ÿ®Ÿàÿßÿ®ÿ©", "ex": "Egypt is a gateway to Africa."}, {"w": "infrastructure", "ar": "ÿ®ŸÜŸäÿ© ÿ™ÿ≠ÿ™Ÿäÿ©", "ex": "Infrastructure connects countries."}, {"w": "partnership", "ar": "ÿ¥ÿ±ÿßŸÉÿ©", "ex": "The two nations built a strong partnership."}, {"w": "stability", "ar": "ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ±", "ex": "Regional stability is essential."}, {"w": "manufactured", "ar": "ŸÖÿµŸÜŸëÿπ", "ex": "Egypt exports manufactured goods."}, {"w": "textiles", "ar": "ŸÖŸÜÿ≥Ÿàÿ¨ÿßÿ™", "ex": "The factory produces high‚Äëquality textiles."}, {"w": "mutual", "ar": "ŸÖÿ™ÿ®ÿßÿØŸÑ", "ex": "They have mutual interests."}, {"w": "scholarship", "ar": "ŸÖŸÜÿ≠ÿ© ÿØÿ±ÿßÿ≥Ÿäÿ©", "ex": "She received a scholarship to study in Cairo."}, {"w": "convoy", "ar": "ŸÇÿßŸÅŸÑÿ© ÿ∑ÿ®Ÿäÿ©", "ex": "A medical convoy visited rural areas."}, {"w": "capacity", "ar": "ŸÇÿØÿ±ÿ© / ÿ∑ÿßŸÇÿ© ÿßÿ≥ÿ™Ÿäÿπÿßÿ®Ÿäÿ©", "ex": "Training increases health system capacity."}], "readingSentences": ["Egypt is strengthening ties with African countries.", "New infrastructure projects are being launched.", "Trade in textiles and manufactured goods is growing.", "Scholarships support African students in Egyptian universities.", "Medical convoys are training local doctors and nurses.", "Partnerships build mutual trust and regional stability."]}, {"title": "Lesson 2", "vocab": [{"w": "integration", "ar": "ÿßŸÜÿØŸÖÿßÿ¨", "ex": "Regional integration supports growth."}, {"w": "hybrid", "ar": "Ÿáÿ¨ŸäŸÜŸä", "ex": "A hybrid system mixes two approaches."}, {"w": "expanding", "ar": "Ÿäÿ™Ÿàÿ≥ÿπ", "ex": "The company is expanding its services."}, {"w": "rural", "ar": "ÿ±ŸäŸÅŸä", "ex": "Rural areas need better services."}, {"w": "stable", "ar": "ŸÖÿ≥ÿ™ŸÇÿ±", "ex": "We need a stable plan."}, {"w": "funding", "ar": "ÿ™ŸÖŸàŸäŸÑ", "ex": "The project requires more funding."}, {"w": "renewable", "ar": "ŸÖÿ™ÿ¨ÿØŸëÿØ", "ex": "Renewable energy reduces emissions."}, {"w": "irrigation", "ar": "ÿ±ŸäŸë", "ex": "Solar irrigation saves water."}, {"w": "partnerships", "ar": "ÿ¥ÿ±ÿßŸÉÿßÿ™", "ex": "Partnerships help share knowledge."}, {"w": "coverage", "ar": "ÿ™ÿ∫ÿ∑Ÿäÿ©", "ex": "Internet coverage is improving."}], "readingSentences": ["Experts discuss trade with Sub‚ÄëSaharan countries.", "Solar‚Äëpowered irrigation supports rural farming.", "Hybrid solutions make systems more flexible.", "Funding helps expand community projects.", "Stable plans ensure long‚Äëterm success.", "Integration brings teams and ideas together."]}, {"title": "Lesson 3", "vocab": [{"w": "strengthening", "ar": "ÿ™ÿπÿ≤Ÿäÿ≤", "ex": "They are strengthening cooperation now."}, {"w": "launch", "ar": "ÿ•ÿ∑ŸÑÿßŸÇ", "ex": "We are launching a new project this week."}, {"w": "bridge", "ar": "ÿ¨ÿ≥ÿ± / Ÿäÿ®ŸÜŸä ÿ¨ÿ≥Ÿàÿ± ÿ´ŸÇÿ©", "ex": "A bridge is being built across the Nile."}, {"w": "arrangement", "ar": "ÿ™ÿ±ÿ™Ÿäÿ®", "ex": "We are making travel arrangements."}, {"w": "provide", "ar": "ŸäŸàŸÅŸëÿ±", "ex": "Doctors are providing medical help."}, {"w": "pave", "ar": "ŸäŸÖŸáŸëÿØ", "ex": "The road is being paved today."}, {"w": "carry out", "ar": "ŸäŸÜŸÅŸëÿ∞", "ex": "New plans are being carried out."}, {"w": "being built", "ar": "ŸäŸèÿ®ŸÜŸâ ÿßŸÑÿ¢ŸÜ", "ex": "New houses are being built quickly."}, {"w": "being cleaned", "ar": "ŸäŸèŸÜÿ∏ŸëŸÅ ÿßŸÑÿ¢ŸÜ", "ex": "Roads are being cleaned after the rain."}, {"w": "studying", "ar": "Ÿäÿ∞ÿßŸÉÿ± ÿßŸÑÿ¢ŸÜ", "ex": "The students are studying this week."}], "readingSentences": ["New projects are being launched across Africa.", "Important bridges of trust are being built.", "Doctors are providing care in rural clinics.", "Roads are being paved after the storm.", "Students are studying for their exams now.", "Teams are carrying out plans this month."], "grammar": {"title": "Present Continuous ‚Äî Active & Passive", "explain": "Active: subject + am/is/are + verb‚Äëing. Passive: am/is/are + being + past participle. Use for actions happening now or fixed future arrangements.", "drills": [{"q": "Important bridges of trust ___ across Africa now.", "opts": ["are building", "are being built", "built", "will build"], "ok": 1}, {"q": "They ___ a new bridge across the Nile now.", "opts": ["build", "are building", "is built", "are built"], "ok": 1}, {"q": "New houses ___ quickly in this area.", "opts": ["are being built", "is built", "are building", "was built"], "ok": 0}, {"q": "English ___ in many schools right now.", "opts": ["is teaching", "are teaching", "is being taught", "is taught"], "ok": 2}, {"q": "The roads ___ because of the heavy rain today.", "opts": ["are cleaning", "is being cleaned", "are being cleaned", "was cleaned"], "ok": 2}, {"q": "Students ___ for their exams now.", "opts": ["study", "are studying", "are studied", "were studied"], "ok": 1}, {"q": "Doctors ___ medical help at the moment.", "opts": ["provide", "are providing", "provided", "will provide"], "ok": 1}, {"q": "We ___ a meeting with African leaders tomorrow.", "opts": ["hold", "are holding", "held", "will hold"], "ok": 1}, {"q": "Scholarships ___ to African students this year.", "opts": ["are offering", "are being offered", "offered", "will offer"], "ok": 1}, {"q": "The team ___ new arrangements this week.", "opts": ["makes", "is making", "made", "will make"], "ok": 1}, {"q": "Many new projects ___ out in the countryside now.", "opts": ["are carrying", "have carried", "are being carried", "have been carried"], "ok": 2}, {"q": "A new bridge ___ across the river.", "opts": ["is being built", "are building", "was built", "build"], "ok": 0}, {"q": "We ___ to Aswan next week (fixed arrangement).", "opts": ["travel", "are travelling", "travelling", "will travel"], "ok": 1}, {"q": "Food ___ for the event at the moment.", "opts": ["is preparing", "is prepared", "is being prepared", "prepared"], "ok": 2}, {"q": "The clinic ___ today for maintenance.", "opts": ["is closing", "is being closed", "was closed", "closed"], "ok": 0}]}}];
const unitExam = { items: [{"q": "Choose the word for: ÿ®ŸÜŸäÿ© ÿ™ÿ≠ÿ™Ÿäÿ©", "opts": ["expanding", "infrastructure", "coverage", "strengthening"], "ok": 1, "type": "vocab", "ar": "ÿ®ŸÜŸäÿ© ÿ™ÿ≠ÿ™Ÿäÿ©", "word": "infrastructure"}, {"q": "Choose the word for: ŸÇÿØÿ±ÿ© / ÿ∑ÿßŸÇÿ© ÿßÿ≥ÿ™Ÿäÿπÿßÿ®Ÿäÿ©", "opts": ["being cleaned", "stability", "infrastructure", "capacity"], "ok": 3, "type": "vocab", "ar": "ŸÇÿØÿ±ÿ© / ÿ∑ÿßŸÇÿ© ÿßÿ≥ÿ™Ÿäÿπÿßÿ®Ÿäÿ©", "word": "capacity"}, {"q": "Choose the word for: ÿ¨ÿ≥ÿ± / Ÿäÿ®ŸÜŸä ÿ¨ÿ≥Ÿàÿ± ÿ´ŸÇÿ©", "opts": ["textiles", "stability", "bridge", "renewable"], "ok": 2, "type": "vocab", "ar": "ÿ¨ÿ≥ÿ± / Ÿäÿ®ŸÜŸä ÿ¨ÿ≥Ÿàÿ± ÿ´ŸÇÿ©", "word": "bridge"}, {"q": "Choose the word for: ŸäŸàŸÅŸëÿ±", "opts": ["renewable", "provide", "convoy", "coverage"], "ok": 1, "type": "vocab", "ar": "ŸäŸàŸÅŸëÿ±", "word": "provide"}, {"q": "Choose the word for: ŸÖÿµŸÜŸëÿπ", "opts": ["coverage", "infrastructure", "mutual", "manufactured"], "ok": 3, "type": "vocab", "ar": "ŸÖÿµŸÜŸëÿπ", "word": "manufactured"}, {"q": "Choose the word for: ŸÖÿ≥ÿ™ŸÇÿ±", "opts": ["convoy", "partnership", "studying", "stable"], "ok": 3, "type": "vocab", "ar": "ŸÖÿ≥ÿ™ŸÇÿ±", "word": "stable"}, {"q": "Choose the word for: Ÿáÿ¨ŸäŸÜŸä", "opts": ["hybrid", "stability", "being cleaned", "strengthening"], "ok": 0, "type": "vocab", "ar": "Ÿáÿ¨ŸäŸÜŸä", "word": "hybrid"}, {"q": "Choose the word for: ÿ•ÿ∑ŸÑÿßŸÇ", "opts": ["integration", "renewable", "launch", "bridge"], "ok": 2, "type": "vocab", "ar": "ÿ•ÿ∑ŸÑÿßŸÇ", "word": "launch"}, {"q": "Choose the word for: ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ±", "opts": ["pave", "being cleaned", "stability", "partnership"], "ok": 2, "type": "vocab", "ar": "ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ±", "word": "stability"}, {"q": "Choose the word for: ŸäŸÜŸÅŸëÿ∞", "opts": ["hybrid", "textiles", "arrangement", "carry out"], "ok": 3, "type": "vocab", "ar": "ŸäŸÜŸÅŸëÿ∞", "word": "carry out"}, {"q": "Choose the word for: ÿ™ÿ∫ÿ∑Ÿäÿ©", "opts": ["coverage", "capacity", "studying", "funding"], "ok": 0, "type": "vocab", "ar": "ÿ™ÿ∫ÿ∑Ÿäÿ©", "word": "coverage"}, {"q": "Choose the word for: ÿ™ŸÖŸàŸäŸÑ", "opts": ["renewable", "rural", "infrastructure", "funding"], "ok": 3, "type": "vocab", "ar": "ÿ™ŸÖŸàŸäŸÑ", "word": "funding"}, {"q": "Choose the word for: ÿ®Ÿàÿßÿ®ÿ©", "opts": ["gateway", "being cleaned", "stability", "launch"], "ok": 0, "type": "vocab", "ar": "ÿ®Ÿàÿßÿ®ÿ©", "word": "gateway"}, {"q": "Choose the word for: ŸÖÿ™ÿ¨ÿØŸëÿØ", "opts": ["arrangement", "renewable", "stability", "partnerships"], "ok": 1, "type": "vocab", "ar": "ŸÖÿ™ÿ¨ÿØŸëÿØ", "word": "renewable"}, {"q": "Choose the word for: ÿ±ŸäŸÅŸä", "opts": ["manufactured", "gateway", "stability", "rural"], "ok": 3, "type": "vocab", "ar": "ÿ±ŸäŸÅŸä", "word": "rural"}, {"q": "Important bridges of trust ___ across Africa now.", "opts": ["are building", "are being built", "built", "will build"], "ok": 1, "type": "grammar"}, {"q": "They ___ a new bridge across the Nile now.", "opts": ["build", "are building", "is built", "are built"], "ok": 1, "type": "grammar"}, {"q": "New houses ___ quickly in this area.", "opts": ["are being built", "is built", "are building", "was built"], "ok": 0, "type": "grammar"}, {"q": "English ___ in many schools right now.", "opts": ["is teaching", "are teaching", "is being taught", "is taught"], "ok": 2, "type": "grammar"}, {"q": "The roads ___ because of the heavy rain today.", "opts": ["are cleaning", "is being cleaned", "are being cleaned", "was cleaned"], "ok": 2, "type": "grammar"}, {"q": "Students ___ for their exams now.", "opts": ["study", "are studying", "are studied", "were studied"], "ok": 1, "type": "grammar"}, {"q": "Doctors ___ medical help at the moment.", "opts": ["provide", "are providing", "provided", "will provide"], "ok": 1, "type": "grammar"}, {"q": "We ___ a meeting with African leaders tomorrow.", "opts": ["hold", "are holding", "held", "will hold"], "ok": 1, "type": "grammar"}, {"q": "Scholarships ___ to African students this year.", "opts": ["are offering", "are being offered", "offered", "will offer"], "ok": 1, "type": "grammar"}, {"q": "The team ___ new arrangements this week.", "opts": ["makes", "is making", "made", "will make"], "ok": 1, "type": "grammar"}, {"q": "Many new projects ___ out in the countryside now.", "opts": ["are carrying", "have carried", "are being carried", "have been carried"], "ok": 2, "type": "grammar"}, {"q": "A new bridge ___ across the river.", "opts": ["is being built", "are building", "was built", "build"], "ok": 0, "type": "grammar"}, {"q": "We ___ to Aswan next week (fixed arrangement).", "opts": ["travel", "are travelling", "travelling", "will travel"], "ok": 1, "type": "grammar"}, {"q": "Food ___ for the event at the moment.", "opts": ["is preparing", "is prepared", "is being prepared", "prepared"], "ok": 2, "type": "grammar"}, {"q": "The clinic ___ today for maintenance.", "opts": ["is closing", "is being closed", "was closed", "closed"], "ok": 0, "type": "grammar"}] };

const tabs = document.getElementById('tabs');
const content = document.getElementById('content');
const toast = document.getElementById('toast');
const reviewBox = document.getElementById('review');
const reviewBody = document.getElementById('reviewBody');
const studentNameInput = document.getElementById('studentName');
const timerToggle = document.getElementById('timerToggle');

function showToast(t){toast.textContent=t; toast.style.display='block'; setTimeout(()=>toast.style.display='none',1500)}
function speak(t){const u=new SpeechSynthesisUtterance(t); const vs=speechSynthesis.getVoices(); u.lang='en-GB'; u.rate=.9; const v=vs.find(v=>/en-GB/.test(v.lang))||vs[0]; if(v) u.voice=v; speechSynthesis.cancel(); speechSynthesis.speak(u)}
function soundChime(){const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination); g.gain.value=.0001; g.gain.exponentialRampToValueAtTime(.3,ctx.currentTime+.02); g.gain.exponentialRampToValueAtTime(.0001,ctx.currentTime+.35); o.start(); o.stop(ctx.currentTime+.37)}
function soundBuzz(){const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sawtooth'; o.frequency.value=220; o.connect(g); g.connect(ctx.destination); g.gain.value=.0001; g.gain.exponentialRampToValueAtTime(.25,ctx.currentTime+.02); g.gain.exponentialRampToValueAtTime(.0001,ctx.currentTime+.45); o.start(); o.stop(ctx.currentTime+.47)}
function cheer(ok){(ok? soundChime(): soundBuzz());}

const panels=[];
['Lesson 1','Lesson 2','Lesson 3','Lesson 4','Unit Exam'].forEach((name,i)=>{const b=document.createElement('button'); b.className='tab'; b.textContent=name; b.onclick=()=>activate(i); tabs.appendChild(b); const p=document.createElement('section'); p.className='panel'; content.appendChild(p); panels.push(p)});
function activate(i){[...tabs.children].forEach((b,idx)=>b.classList.toggle('active',idx===i)); panels.forEach((p,idx)=>p.classList.toggle('active',idx===i));}

function card(word){const div=document.createElement('div'); div.className='card'; div.innerHTML = `<div class='word'>${word.w}</div><div class='arabic'>${word.ar}</div><div class='example'>${word.ex}</div>`; const tools=document.createElement('div'); tools.style.marginTop='8px'; const b1=document.createElement('button'); b1.className='btn'; b1.textContent='üîä Word'; b1.onclick=()=>speak(word.w); const b2=document.createElement('button'); b2.className='btn out'; b2.textContent='üîä Example'; b2.onclick=()=>speak(word.ex); tools.append(b1,b2); div.appendChild(tools); return div }
function buildDictation(words){const wrap=document.createElement('div'); wrap.className='dict'; const title=document.createElement('h3'); title.textContent='Dictation ‚Äî Type the English word (Arabic meaning)'; wrap.appendChild(title); words.forEach(w=>{const row=document.createElement('div'); row.className='rowi'; row.innerHTML=`<span class='pill'>${w.ar}</span><input type='text' placeholder='type the word'><button class='btn'>Check</button>`; const btn=row.querySelector('button'); const inp=row.querySelector('input'); btn.onclick=()=>{const ok=inp.value.trim().toLowerCase()===w.w.toLowerCase(); cheer(ok); showToast(ok? 'Great!':'Correct: '+w.w); if(!ok) speak(w.w)}; wrap.appendChild(row)}); return wrap }
function buildMatching(words){const wrap=document.createElement('div'); wrap.className='match'; const left=document.createElement('div'); left.className='pile'; const right=document.createElement('div'); right.className='pile'; wrap.append(left,right); const meanings=[...words].sort(()=>Math.random()-0.5); meanings.forEach(w=>{const s=document.createElement('div'); s.className='slot'; s.dataset.target=w.w.toLowerCase(); s.textContent=w.ar; right.appendChild(s)}); const drags=[...words].sort(()=>Math.random()-0.5); drags.forEach(w=>{const d=document.createElement('div'); d.className='draggable'; d.draggable=true; d.textContent=w.w; d.dataset.word=w.w.toLowerCase(); d.addEventListener('dragstart',e=>{e.dataTransfer.setData('text', d.dataset.word)}); left.appendChild(d)}); right.querySelectorAll('.slot').forEach(slot=>{slot.addEventListener('dragover',e=>e.preventDefault()); slot.addEventListener('drop',e=>{const ww=e.dataTransfer.getData('text'); const ok= ww===slot.dataset.target; if(ok){slot.classList.add('filled'); slot.textContent=slot.textContent+'  ‚úÖ '+ww; cheer(true); speak(ww); showToast('Matched!')} else {cheer(false); showToast('Not a match')}})}); return wrap }
function buildQuiz(words){const q=document.createElement('div'); q.className='quiz'; const title=document.createElement('h3'); title.textContent='Vocabulary in Context (MCQ)'; q.appendChild(title); const set=[...words].sort(()=>Math.random()-0.5).slice(0,8); set.forEach(item=>{const box=document.createElement('div'); box.style.margin='10px 0'; const prompt=document.createElement('div'); prompt.style.fontWeight='900'; prompt.textContent=item.ex; box.appendChild(prompt); const choices=document.createElement('div'); choices.className='choices'; box.appendChild(choices); const pool=[item.w, ...words.filter(x=>x.w!==item.w).slice(0,3).map(x=>x.w)]; pool.sort(()=>Math.random()-0.5); pool.forEach(opt=>{const c=document.createElement('div'); c.className='choice'; c.textContent=opt; c.onclick=()=>{const ok=opt===item.w; c.classList.add(ok?'ok':'bad'); cheer(ok); if(!ok) showToast('Correct: '+item.w); else speak(item.w)}; choices.appendChild(c)}); q.appendChild(box)}); return q }
function buildReading(sentences){const wrap=document.createElement('div'); const h=document.createElement('h3'); h.textContent='Reading ‚Äî 6 short sentences'; wrap.appendChild(h); sentences.forEach(s=>{const row=document.createElement('div'); row.className='sent'; const b=document.createElement('button'); b.className='btn'; b.textContent='üîä'; b.onclick=()=>speak(s); const span=document.createElement('span'); span.textContent=s; row.append(b,span); wrap.appendChild(row)}); return wrap }
function buildGrammar(g){const wrap=document.createElement('div'); wrap.className='card'; const h=document.createElement('h3'); h.textContent=g.title; const p=document.createElement('p'); p.textContent=g.explain; wrap.append(h,p); g.drills.forEach(item=>{const el=document.createElement('div'); el.className='item'; const q=document.createElement('div'); q.style.fontWeight='800'; q.textContent=item.q; el.appendChild(q); const opts=document.createElement('div'); el.appendChild(opts); const shuffled=item.opts.map((t,i)=>({t,i})).sort(()=>Math.random()-0.5); shuffled.forEach(({t,i})=>{const b=document.createElement('div'); b.className='choice'; b.textContent=t; b.onclick=()=>{if(el.dataset.locked) return; const ok=i===item.ok; b.classList.add(ok?'ok':'bad'); cheer(ok); if(!ok) showToast('Correct: '+item.opts[item.ok]); el.dataset.locked='1'}; opts.appendChild(b)}); wrap.appendChild(el)}); return wrap }

function explain(itm){
  if(itm.type==='vocab') return `This word means: ${itm.ar}`;
  // grammar generic explanation
  const t=itm.opts[itm.ok];
  if(/being/.test(t)) return 'Passive form: am/is/are + being + past participle ‚Äî action done to the subject.';
  if(/are|am|is\s+\w+ing/.test(t) || /(are|am|is)\s+\w+ing/.test(t)) return 'Present Continuous (active): subject + am/is/are + verb‚Äëing for actions happening now or fixed future arrangements.';
  return 'Choose the form that matches Present Continuous (active) or Passive according to meaning.';
}

function unitExamView(exam){
  const wrap=document.createElement('div'); wrap.className='exam';
  const h=document.createElement('h3'); h.textContent='UNIT EXAM ‚Äî 30 sentences (Vocabulary & Grammar)'; wrap.appendChild(h);
  let score=0; let answered=0; let streak=0; let bestStreak=0; let timerId=null; let remaining=12*60; let lockedAll=false;
  const info=document.createElement('div'); info.className='tools';
  const scoreBox=document.createElement('div'); scoreBox.className='pill'; scoreBox.textContent='Score: 0/'+exam.items.length; info.appendChild(scoreBox);
  const streakBox=document.createElement('div'); streakBox.className='pill'; streakBox.innerHTML='Streak: <span class="streak">0</span>'; info.appendChild(streakBox);
  const progress=document.createElement('div'); progress.className='progress'; const bar=document.createElement('div'); progress.appendChild(bar); info.appendChild(progress);
  const timerSpan=document.createElement('div'); timerSpan.className='timer'; timerSpan.style.display='none'; info.appendChild(timerSpan);
  const reset=document.createElement('button'); reset.className='btn'; reset.textContent='Reset'; reset.onclick=()=>{wrap.parentElement.replaceChild(unitExamView(exam), wrap)}; info.appendChild(reset);
  const autocorrect=document.createElement('button'); autocorrect.className='btn out'; autocorrect.textContent='Auto-correct'; autocorrect.onclick=()=>{autoCorrectAll()}; info.appendChild(autocorrect);
  const reviewBtn=document.createElement('button'); reviewBtn.className='btn out'; reviewBtn.textContent='Review'; reviewBtn.onclick=()=>openReview(); info.appendChild(reviewBtn);
  const nextUnAns=document.createElement('button'); nextUnAns.className='btn out'; nextUnAns.textContent='Next unanswered (N)'; nextUnAns.onclick=()=>focusNextUnanswered(); info.appendChild(nextUnAns);
  const certBtn=document.createElement('button'); certBtn.className='btn out'; certBtn.textContent='Print Certificate'; certBtn.onclick=()=>printCertificate(); certBtn.style.display='none'; info.appendChild(certBtn);
  wrap.appendChild(info);

  const items=[];
  exam.items.forEach((itm,idx)=>{
    const item=document.createElement('div'); item.className='item'; item.tabIndex=0;
    const qq=document.createElement('div'); qq.style.fontWeight='800'; qq.textContent=(idx+1)+'. '+itm.q; item.appendChild(qq);
    const opts=document.createElement('div'); item.appendChild(opts);
    const shuffled=itm.opts.map((t,i)=>({t,i})).sort(()=>Math.random()-0.5);
    shuffled.forEach(({t,i},btnIdx)=>{
      const c=document.createElement('div'); c.className='choice'; c.textContent=t; c.dataset.index=btnIdx+1; // for keyboard (1..4)
      c.onclick=()=>selectChoice(i, c);
      opts.appendChild(c)
    });
    items.push({node:item, data:itm});
    wrap.appendChild(item);

    function selectChoice(i, c){
      if(item.dataset.locked || lockedAll) return;
      const ok = i===itm.ok; item.dataset.locked='1';
      answered++; if(ok){score++; streak++; bestStreak=Math.max(bestStreak,streak);} else {streak=0;}
      c.classList.add(ok?'ok':'bad');
      if(!ok){ showToast('Correct: '+itm.opts[itm.ok]); speak(itm.opts[itm.ok]); }
      scoreBox.textContent='Score: '+score+'/'+exam.items.length;
      bar.style.width = Math.round((answered/exam.items.length)*100)+'%';
      streakBox.innerHTML='Streak: <span class="streak">'+streak+'</span>';
      item.dataset.your = c.textContent; item.dataset.explain = explain(itm);
    }
  });

  function autoCorrectAll(){
    items.forEach(({node,data})=>{
      if(node.dataset.locked) return;
      const options=[...node.querySelectorAll('.choice')];
      options.forEach(o=>o.classList.add('bad'));
      const correctText=data.opts[data.ok];
      const corr=options.find(o=>o.textContent.trim().toLowerCase()===correctText.toLowerCase());
      if(corr){corr.classList.remove('bad'); corr.classList.add('ok');}
      node.dataset.locked='1';
      node.dataset.your = '(no answer)';
      node.dataset.explain = explain(data);
      answered++;
    });
    bar.style.width = '100%';
    soundChime(); showToast('Auto-correct applied');
    finalize();
  }

  function openReview(){
    reviewBody.innerHTML='';
    items.forEach(({node,data},i)=>{
      const your=node.dataset.your||'(no answer)';
      const correct=data.opts[data.ok];
      const qa=document.createElement('div'); qa.className='qa';
      const cls = your.toLowerCase()==correct.toLowerCase()? 'okpill':'badpill';
      qa.innerHTML = `<div style='font-weight:800'>${i+1}. ${data.q}</div><div>Your: <span class='${cls}'>${your}</span> ‚Ä¢ Correct: <span class='okpill'>${correct}</span></div><div style='margin-top:4px; opacity:.8'>Hint: ${node.dataset.explain || explain(data)}</div>`;
      reviewBody.appendChild(qa)
    });
    reviewBox.style.display='flex';
  }

  document.getElementById('closeReview').onclick=()=>{reviewBox.style.display='none'};

  function badgeFor(pct){ if(pct>=90) return 'Gold'; if(pct>=80) return 'Silver'; if(pct>=70) return 'Bronze'; return '‚Äî'; }

  function finalize(){
    if(lockedAll) return; lockedAll=true;
    const pct = Math.round((score/exam.items.length)*100);
    const badge = badgeFor(pct);
    showToast('Finished ‚Ä¢ '+pct+'% ‚Ä¢ Badge: '+badge+' ‚Ä¢ Best streak: '+bestStreak);
    // show certificate button if >=85
    if(pct>=85){ certBtn.style.display='inline-block'; }
  }

  function focusNextUnanswered(){
    for(const {node} of items){ if(!node.dataset.locked){ node.scrollIntoView({behavior:'smooth', block:'center'}); node.classList.add('pulse'); setTimeout(()=>node.classList.remove('pulse'),700); return; } }
    showToast('All answered'); finalize();
  }

  // Timer support
  if(timerToggle.checked){
    timerSpan.style.display='block';
    timerSpan.textContent='‚è± 12:00';
    timerId=setInterval(()=>{
      if(lockedAll){ clearInterval(timerId); return; }
      remaining--; const m=String(Math.floor(remaining/60)).padStart(2,'0'); const s=String(remaining%60).padStart(2,'0');
      timerSpan.textContent='‚è± '+m+':'+s;
      if(remaining<=0){ clearInterval(timerId); autoCorrectAll(); }
    },1000);
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if(lockedAll) return;
    const keys=['1','2','3','4'];
    if(keys.includes(e.key)){
      // target first unlocked item and click matching choice index
      for(const {node} of items){ if(!node.dataset.locked){ const idx=parseInt(e.key,10); const c=node.querySelector(`.choice:nth-child(${idx})`); if(c){ c.click(); } break; } }
    }
    if(e.key==='N' || e.key==='n'){ focusNextUnanswered(); }
    if(e.key==='R' || e.key==='r'){ reset.click(); }
  });

  // Detect when all answered to finalize
  const observer=new MutationObserver(()=>{
    const lockedCount=items.filter(({node})=>node.dataset.locked).length;
    if(lockedCount===items.length){ finalize(); observer.disconnect(); }
  });
  observer.observe(wrap,{subtree:true, attributes:true, attributeFilter:['data-locked']});

  function printCertificate(){
    const name = (studentNameInput.value||'Student');
    const pct = Math.round((score/exam.items.length)*100);
    const badge = badgeFor(pct);
    document.getElementById('certName').textContent=name;
    document.getElementById('certScore').textContent=pct+'%';
    document.getElementById('certBadge').textContent=badge;
    window.print();
  }

  return wrap;
}

function lessonPanel(lesson){const panel=document.createElement('section'); const subt=document.createElement('div'); subt.className='subtabs'; panel.appendChild(subt); const names=['Vocabulary','Games','Reading','Exam']; if(lesson.grammar) names.splice(2,0,'Grammar'); const views=names.map(()=>{const v=document.createElement('div'); panel.appendChild(v); return v}); function act(i){[...subt.children].forEach((b,idx)=>b.classList.toggle('active',idx===i)); views.forEach((v,idx)=>v.style.display= idx===i?'block':'none')} names.forEach((n,i)=>{const b=document.createElement('button'); b.className='sub'; b.textContent=n; b.onclick=()=>act(i); subt.appendChild(b)}); const grid=document.createElement('div'); grid.className='grid'; lesson.vocab.forEach(w=>grid.appendChild(card(w))); views[names.indexOf('Vocabulary')].appendChild(grid); views[names.indexOf('Vocabulary')].appendChild(buildDictation(lesson.vocab)); const games=document.createElement('div'); games.appendChild(buildMatching(lesson.vocab)); games.appendChild(document.createElement('hr')); games.appendChild(buildQuiz(lesson.vocab)); views[names.indexOf('Games')].appendChild(games); if(lesson.grammar){views[names.indexOf('Grammar')].appendChild(buildGrammar(lesson.grammar));} views[names.indexOf('Reading')].appendChild(buildReading(lesson.readingSentences)); const mini={items: lesson.vocab.slice(0,5).map(v=>({q:'Pick the English word: '+v.ar, opts:[v.w, ...lesson.vocab.filter(x=>x.w!==v.w).slice(0,3).map(x=>x.w)], ok:0, type:'vocab', ar:v.ar, word:v.w}))}; views[names.indexOf('Exam')].appendChild(unitExamView(mini)); act(0); return panel }

lessons.forEach((lsn,idx)=>{const p=document.createElement('section'); p.className='panel'; content.appendChild(p); p.appendChild(lessonPanel(lsn))}); const unitPanel=document.createElement('section'); unitPanel.className='panel'; unitPanel.appendChild(unitExamView(unitExam)); content.appendChild(unitPanel);
const names=['Lesson 1','Lesson 2','Lesson 3','Lesson 4','Unit Exam']; const panels=[...content.children]; names.forEach((t,i)=>{const b=document.createElement('button'); b.className='tab'; b.textContent=t; b.onclick=()=>{[...document.querySelectorAll('.tab')].forEach((bb,idx)=>bb.classList.toggle('active',idx===i)); panels.forEach((pp,idx)=>pp.classList.toggle('active',idx===i))}; tabs.appendChild(b)}); panels.forEach((pp,idx)=>pp.classList.toggle('active',idx===0)); tabs.querySelector('.tab').classList.add('active');

document.getElementById('shareBtn').addEventListener('click', async ()=>{ const url = window.location.href; if(navigator.share){ try{ await navigator.share({title:'2ND SEC TERM 1 ‚Äî Unit 1', text:'Check our interactive mini platform!', url}); showToast('Shared!'); }catch(e){ showToast('Share cancelled'); } } else { try{ await navigator.clipboard.writeText(url); showToast('Link copied to clipboard'); }catch(e){ showToast('Copy the URL manually'); } } });
document.getElementById('closeReview').addEventListener('click',()=>{reviewBox.style.display='none'});
</script>
</body>
</html>
